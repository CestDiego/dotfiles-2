<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<title>Geocode resolver</title>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
  var geocoder;

  /**
   * Called on page load.
   */
  function initialize() {
    geocoder = new google.maps.Geocoder();
  }

  /**
   * Given a text that we think is an address, call the geocoding api and if
   * results come back, call the callback with the resolved address.
   * In case the original address turns out to not be a geocode, the callback
   * is called with an empty string as parameter.
   */
  function codeAddress(address, callback) {
    if (geocoder) {
      geocoder.geocode({ 'address': address}, function(results, status) {
        text = '';
        if (status == google.maps.GeocoderStatus.OK) {
          text = results[0].formatted_address;
        }
        callback(text);
      });
    }
  }

  // Listen for content scripts trying to tell us something.
  chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
    codeAddress(request.greeting, function(resp) {
	  sendResponse(resp);
    });
  });

</script>
</head>
<body style="margin:0px; padding:0px;" onload="initialize()">
</body>
</html>
